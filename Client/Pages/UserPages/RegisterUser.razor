@page "/register"
@inject HttpClient Http
@using System.Net.Http.Json
@using Client.Models

@*Author: Susanna Renström*@

<h3>RegisterUser</h3>

<EditForm Model="RegisterModel" OnSubmit="Submit">
    <div>
    <label>Förnamn</label>
    <InputText @bind-Value="RegisterModel.FirstName"></InputText>
    </div>
    <div>
    <label>Efternamn</label>
    <InputText @bind-Value="RegisterModel.LastName"></InputText>
    </div>
    <div>
    <label>Epostadress</label>
    <InputText @bind-Value="RegisterModel.Email"></InputText>
    </div>
    <div>
    <label>Lösenord</label>
    <InputText @bind-Value="RegisterModel.Password"></InputText>
    </div>
    <div>
        <label>Telefonnummer</label>
        <InputText @bind-Value="RegisterModel.PhoneNumber"></InputText>
    </div>
    <div>
    <label>URL för Avatar</label>
    <InputText @bind-Value="RegisterModel.Avatar"></InputText>
    </div>
    <div>
    <label>Mäklarfirma</label>
    <select @bind="AgencyId">
        <option value="">Ange mäklarfirma</option>
       @foreach(var agency in Agencies)
        {
            <option value="@agency.AgencyId">@agency.NameOfAgency</option>
        }
    </select>
    </div>
    <button type="submit">Spara</button>
</EditForm>

@code {

    public Response Response {get; set;}
    public RegisterModel RegisterModel { get; set; } = new RegisterModel();
    public int AgencyId { get; set; }
    public List<Agency> Agencies { get; set; } = new List<Agency>();

    protected override async Task OnInitializedAsync()
    {

        Agencies = await Http.GetFromJsonAsync<List<Agency>>("api/agency");


    }

    public async void Submit()
    {   
        
        RegisterModel.Agency = await Http.GetFromJsonAsync<Agency>($"api/agency/{AgencyId}");
        var result = await Http.PostAsJsonAsync<RegisterModel>("api/authenticate/register", RegisterModel); 
      
    }

}
